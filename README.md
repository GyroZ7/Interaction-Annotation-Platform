# 交互式标注平台

这是一个基于 Gradio 的 Web 应用程序，用于在图片上标注用户交互。您可以标记交互点，指定交互类型（点击、多次点击、长按、滑动），并设置相关参数。

## 如何运行应用

### 1. 设置并激活虚拟环境

我们建议在 Python 虚拟环境中运行此应用，以避免与系统范围的包产生冲突。

- **创建虚拟环境:**
  在项目根目录下打开终端，并运行以下命令：
  ```bash
  python3 -m venv interaction_annotation
  ```
  这会创建一个名为 `interaction_annotation` 的文件夹，其中包含虚拟环境。

- **激活虚拟环境:**
  - 在 macOS 或 Linux 上:
    ```bash
    source interaction_annotation/bin/activate
    ```
  - 在 Windows 上:
    ```bash
    .\interaction_annotation\Scripts\activate
    ```
  激活后，您的终端提示符前应该会显示 `(interaction_annotation)`。

### 2. 安装依赖

激活虚拟环境后，运行以下命令安装所需的库：
```bash
pip install -r requirements.txt
```

### 3. 启动应用

确保您仍在已激活虚拟环境的终端中，然后运行：
```bash
python app.py
```
或者，使用 Gradio CLI：
```bash
gradio app.py
```

### 4. 在浏览器中打开

启动后，终端会显示一个本地 URL，通常是 `http://127.0.0.1:7860`。将此 URL 复制并粘贴到您的网络浏览器中以打开应用界面。

## 目录结构

应用需要特定的目录结构来查找用于标注的图片。

```
.
├── test_folder/                # 存放所有测试集的根目录
│   ├── <你的测试集_1>/          # 代表一组测试的文件夹 (例如, kesong)
│   │   ├── test_img/             # 此目录是必需的
│   │   │   ├── <test_id_1>/      # 代表一个具体测试用例的子文件夹
│   │   │   │   └── imgs/         # 此目录是必需的，包含该测试用例的图片
│   │   │   │       ├── image1.png
│   │   │   │       └── image2.jpg
│   │   │   ├── <test_id_2>/
│   │   │   │   └── imgs/
│   │   │   │       └── ...
│   │   │   └── interactions.json # 标注文件 (可选, 用于加载已有标注)
│   │   └── test_result/          # 测试结果目录 (当前版本未使用)
│   └── <你的测试集_2>/
│       └── ...
├── app.py                      # 主应用文件
└── requirements.txt            # 依赖文件
```

- **`test_folder`**: 所有测试集的根目录。
- **`<你的测试集_1>`**: 代表一组测试的文件夹（例如 `kesong`, `test_img_benchmark`）。您将在界面的下拉菜单中选择此文件夹。
- **`test_img`**: 测试集文件夹中必须包含此目录。
- **`<test_id_1>`**: `test_img` 内的子文件夹，代表一个具体的测试用例。
- **`imgs`**: 测试用例文件夹中必须包含此目录，存放该用例需要标注的图片。
- **`interactions.json`**: 当您导出标注时，此文件将在 `test_img` 目录中被创建或更新。它也用于加载已有的标注。
- **`test_result`**: 此目录在当前版本的 `app.py` 中未使用，但似乎是项目结构的一部分。

## 如何使用标注界面

1.  **选择测试文件夹:** 从“选择测试文件夹”下拉菜单中，选择您要处理的测试集（例如 `kesong`）。
2.  **开始:** 点击“开始”按钮。这将加载所选测试集中的测试用例（Test ID）和第一个用例的第一张图片。
3.  **浏览图片:**
    -   使用“Test ID”下拉菜单在不同测试用例之间切换。
    -   使用“上一张”和“下一张”按钮浏览当前测试用例中的图片。
4.  **标注交互:**
    -   **选择工具:** 从“工具”单选按钮中选择交互类型：
        -   `click`: 单次点击。
        -   `multiclick`: 在同一位置多次点击。请设置“点击次数”。
        -   `longpress`: 长按。请设置“持续时间 (ms)”。
        -   `slide`: 从起点到终点的滑动。请设置“持续时间 (ms)”。
    -   **在图片上标记:**
        -   对于 `click`、`multiclick` 和 `longpress`，在图片上交互发生的位置单击。一个彩色的点将会出现。
        -   对于 `slide`，首先点击滑动的起点，然后点击终点。一个箭头将会被画出。
    -   “基准点”文本框会显示标记点的归一化坐标。
5.  **导出标注:**
    -   在标注完一张图片后，点击“导出交互”按钮。
    -   这会将当前图片的标注保存或更新到相应 `test_img` 目录下的 `interactions.json` 文件中。应用的状态也会同步更新。您可以继续标注其他图片，所有更改都会被增量保存。

## `app.py` 中的可调参数

您可以直接编辑 `app.py` 文件来微调标注的可视化效果。

-   **点半径:** 在 `draw_point_on_image` 函数中，您可以修改 `radius` 变量来使标注点变大或变小。
-   **箭头外观 (用于 'slide' 交互):** 同样在 `draw_point_on_image` 函数中，您可以调整：
    -   `arrow_line_width`: 箭头线条的粗细。
    -   `arrowhead_length`: 箭头的长度。
    -   `arrowhead_angle`: 箭头翼的角度。
-   **图片显示高度:** 在 `create_app` 函数中，您可以修改 `gr.Image` 组件的 `height` 参数来调整图片显示区域的大小。